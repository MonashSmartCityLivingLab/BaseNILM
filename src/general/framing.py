#######################################################################################################################
#######################################################################################################################
# Title:        BaseNILM toolkit for energy disaggregation
# Topic:        Non-intrusive load monitoring utilising machine learning, pattern matching and source separation
# File:         framing
# Date:         23.05.2024
# Author:       Dr. Pascal A. Schirmer
# Version:      V.1.0
# Copyright:    Pascal Schirmer
#######################################################################################################################
#######################################################################################################################

#######################################################################################################################
# Function Description
#######################################################################################################################
"""
This function frames the input data into block-frames with length "window" and overlap between two different windows.
Inputs:     1) data:    input data
            2) window:  window length for framing
            3) overlap: overlap between two windows
Outputs:    1) out:     framed output feature vector
"""

#######################################################################################################################
# Import libs
#######################################################################################################################
# ==============================================================================
# Internal
# ==============================================================================
from src.external.sliding_window import sliding_window

# ==============================================================================
# External
# ==============================================================================
import numpy as np


#######################################################################################################################
# Function
#######################################################################################################################
def framing(data, window, overlap):
    ###################################################################################################################
    # MSG IN
    ###################################################################################################################
    print("INFO: Start framing data")

    ###################################################################################################################
    # Initialisation
    ###################################################################################################################
    # ==============================================================================
    # Parameters
    # ==============================================================================
    dim = data.ndim
    fields = data.columns

    ###################################################################################################################
    # Calculation
    ###################################################################################################################
    # ==============================================================================
    # Init
    # ==============================================================================
    step = window - overlap

    # ==============================================================================
    # Calc
    # ==============================================================================
    if dim == 2:
        temp = np.shape(data)
        out = np.zeros((int(np.floor(temp[0] / step) + window), window, data.shape[1]))
        for i in range(0, len(fields)):
            temp = sliding_window(data[fields[i]].values, window, step)
            out[0:len(temp), :, i] = sliding_window(data[fields[i]].values, window, step)
        out = out[0:len(temp), :, :]
    else:
        out = sliding_window(data, window, step)

    ###################################################################################################################
    # Return
    ###################################################################################################################
    return out
