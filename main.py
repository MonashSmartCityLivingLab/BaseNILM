#######################################################################################################################
#######################################################################################################################
# Title: Baseline NILM Architecture
# Topic: Non-intrusive load monitoring utilising machine learning, pattern matching and source separation
# File: main
# Date: 23.10.2021
# Author: Dr. Pascal A. Schirmer
# Version: V.0.0
# Copyright: Pascal A. Schirmer
#######################################################################################################################
#######################################################################################################################


#######################################################################################################################
# Import external libs
#######################################################################################################################
from lib.fnc.loadData import loadData
from lib.train import train
from lib.test import test
import time


#######################################################################################################################
# Function
#######################################################################################################################
def main(setup_Exp, setup_Data, setup_Para, setup_Mdl, basePath, dataPath, mdlPath, resultPath, setup_Feat_One, setup_Feat_Mul):
    ####################################################################################################################
    # Welcome Message
    ####################################################################################################################
    # ------------------------------------------
    # Msg
    # ------------------------------------------
    print("-----------------------------------------------------------------------------------------------------------")
    print("-----------------------------------------------------------------------------------------------------------")
    print("Welcome to Base-NILM tool!")
    print("Author:     Dr. Pascal Alexander Schirmer")
    print("Copyright:  Dr. Pascal Alexander Schirmer")
    print("Date:       23.10.2021 \n \n")
    print("Running NILM tool: Conventional Mode (single-fold)")
    print("Algorithm:       " + str(setup_Para['algorithm']))
    print("Classifier:      " + setup_Para['classifier'])
    print("Dataset:         " + setup_Data['dataset'])
    print("House Train:     " + str(setup_Data['houseTrain']))
    print("House Test:      " + str(setup_Data['houseTest']))
    print("House Val:       " + str(setup_Data['houseVal']))
    print("Configuration:   " + setup_Exp['configuration_name'])
    print("Experiment name: " + setup_Exp['experiment_name'])
    print("Plotting:        " + str(setup_Exp['plotting']))
    print("-----------------------------------------------------------------------------------------------------------")
    print("-----------------------------------------------------------------------------------------------------------")

    # ------------------------------------------
    # Time
    # ------------------------------------------
    start = time.time()

    ####################################################################################################################
    # Training
    ####################################################################################################################
    if setup_Exp['train'] == 1:
        # ------------------------------------------
        # Load data
        # ------------------------------------------
        [dataTrain, _, dataVal, _, _, _, setup_Data] = loadData(setup_Data, dataPath)

        # ------------------------------------------
        # Train
        # ------------------------------------------
        train(dataTrain, dataVal, setup_Exp, setup_Data, setup_Para, setup_Mdl, setup_Feat_One, setup_Feat_Mul,
              basePath, mdlPath)

    ####################################################################################################################
    # Testing
    ####################################################################################################################
    if setup_Exp['test'] == 1:
        # ------------------------------------------
        # Load data
        # ------------------------------------------
        [_, dataTest, _, _, _, _, setup_Data] = loadData(setup_Data, dataPath)

        # ------------------------------------------
        # Test
        # ------------------------------------------
        [_, _] = test(dataTest, setup_Exp, setup_Data, setup_Para, setup_Mdl, setup_Feat_One, setup_Feat_Mul, basePath,
                      mdlPath, resultPath)

    ####################################################################################################################
    # End Message
    ####################################################################################################################
    print("-----------------------------------------------------------------------------------------------------------")
    print("-----------------------------------------------------------------------------------------------------------")
    print("End Base-NILM tool!")
    print("Time: " + str(time.time()-start))
    print("-----------------------------------------------------------------------------------------------------------")
    print("-----------------------------------------------------------------------------------------------------------")